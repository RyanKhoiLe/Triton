<!DOCTYPE HTML>
<html>
<head>
  <!-- created by Khoi Le 2016 !-->
  <title> New Exhibit Page Creator </title>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="stylesheets/tritonCreateCSS.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="icon" href="images/tritonIconSmall.png">
  <script src="https://www.gstatic.com/firebasejs/3.2.1/firebase.js"></script>
</head>
<body>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCVFksGcDoYDk23wAG58XdYdfyDL7urzUY",
      authDomain: "learnfirebase-43e98.firebaseapp.com",
      databaseURL: "https://learnfirebase-43e98.firebaseio.com",
      storageBucket: "learnfirebase-43e98.appspot.com",
    };
    firebase.initializeApp(config);
    var url = "https://learnfirebase-43e98.firebaseio.com";
    var firebaseRef = firebase.database();

    function createNewPage(){
      var title = document.getElementById("title").value,
      artist = document.getElementById("artist").value,
      year = document.getElementById("year").value,
      genre = document.getElementById("genre").value,
      media = document.getElementById("media").value,
      exhibitImage = document.getElementById("exhibitImage").value,
      summary = document.getElementById("summary").value,
      symbols = document.getElementById("symbols").value,
      historyOfArtist = document.getElementById("historyOfArtist").value,
      historyOfPainting = document.getElementById("historyOfPainting").value,
      videos = document.getElementById("videos").value,
      timeStamp = getTimeStamp(),
      exhibitCode = document.getElementById("exhibitCode").value,
      exhibit = document.getElementById("exhibitDropdown").value;

      var fbKey;
      var exhKey;
      if(title && artist && summary && symbols){
        fbKey = firebaseRef.ref('exhibits/').push({
            title: title,
            artist: artist,
            year: year,
            genre: genre,
            media: media,
            exhibitImage: exhibitImage,
            summary: summary,
            symbols: symbols,
            historyOfArtist: historyOfArtist,
            historyOfPainting: historyOfPainting,
            videos: videos,
            timeStamp: timeStamp,
            views: 0,
            exhibitCode: exhibitCode,
            exhibit: exhibit
        }).key;
        firebaseRef.ref('exhibitKeys/').push({
          key: fbKey
        },function(){
          console.log("successfully written to firebase");
          document.getElementById('result').innerHTML = 'Congrats your new page has been created';
          var createConfirm = confirm('Congratulations, your new exhibit page was created! Create another exhibit? (If you press cancel, you will go to the database explorer)');
          if(createConfirm){
            location.href='pagecreator.html';
          }
          else{
            location.href='databaseExplorer.html';
          }
        });
      }
      else {
        document.getElementById('result').innerHTML = 'We want to push your best content. Please provide a title, artist, summary, and symbols.';
        alert('LunaSphere wants to push your best content. Please enter a title, artist, summary, and symbols');
      }

    }
    function getTimeStamp(){
      var now = new Date();
      var date = [now.getMonth() + 1, now.getDate(), now.getFullYear()];
      var time = [now.getHours(), now.getMinutes()];
      var suffix = (time[0] < 12) ? "AM" : "PM";
      time[0] = (time[0] < 12) ? time[0] : time[0] - 12;

      for(var i = 1; i < 3; i++){
        if(time[i] < 10) {
          time[i] = "0" + time[i];
        }
      }

      return date.join("/") + ", " + time.join(":") + " " + suffix;
    }


    document.body.onscroll = function(){
      console.log('scrollTop: ' + document.body.scrollTop);
    }
    </script>
    <div id="headBar">
      <a href="www.lunasphere.com"><img id="lunasphereLogo" src="images/Logo.png" alt="Lunasphere"></a>
      <h1 id="pageTitle"> New Exhibit </h1>
      <a href="index.html"><img id="logoPageCreator" src="images/tritonIcon.png" alt="triton"></a>
      <div id="navBar">
        <a class="navBarLink"  href="edithome.html"> database home </a>
        <a class="navBarLink"  href="databaseExplorer.html"> database explorer </a>
      </div>
    </div>
    <div id="wrapper" width="90%">
        <div id="centerBox">


        <form action="#" onsubmit="event.preventDefault(); createNewPage()">
          <div class="inputContainer">
            <div class="textContainer">
              <h2> Exhibit: </h2>
            </div>
            <select id='exhibitDropdown' name="exhibitSelect">
              <option value='exhibit'>Wendy Red Star</option>
              <option value='new'>Create new exhibit</option>
            </select>
          </div>
          <div class="inputContainer">
            <div class="textContainer">
              <h2> Title: </h2>
            </div>
            <input type="text" id="title" placeholder="Las Meninas">
          </div>
          <div class="inputContainer">
            <div class="textContainer">
              <h2> Artist: </h2>
            </div>
            <input type="text" id="artist" placeholder="Pablo Picasso">
          </div>
          <div class="inputContainer">
            <div class="textContainer">
              <h2> Year: </h2>
            </div>
            <input type="text" id="year" placeholder="1957">
          </div>
          <div class="inputContainer">
            <div class="textContainer">
              <h2> Genre: </h2>
            </div>
            <input type="text" id="genre" placeholder="Abstract">
          </div>
          <div class="inputContainer">
            <div class="textContainer">
              <h2> Media: </h2>
            </div>
            <input type="text" id="media" placeholder="Oil on canvas">
          </div>
          <div class="inputContainer">

              <h2 class="longDescription"> Exhibit Lookup Code (this is the number shown next to the QR code at the exhibit, so that people can type it into the website if they don't want to use QR): </h2>

            <input type="text" id="exhibitCode" style="float: none" placeholder="101">
          </div>
          <div class="inputContainer">
            <h2 class="longDescription"> Audio (please select a high-quality .mp3 file and upload below).</h2> <h3> It should be successfully uploaded and say audio/[filename] in the box below: </h3><br>
            <input class='uploadFile' accept='audio/*' name='fileUpload' type='file' id='audioUpload'/>
            <label for='audioUpload' id='audioUploadLabel'>Choose a file</label>
            <p id='percentUpload'>No file selected</p>
            <input type="text" id="exhibitAudio" style='float:none' placeholder="audio/[filename].mp3">
            <script>

              var imageUpload = document.getElementById("audioUpload");
              imageUpload.onchange = function(evt) {
                var firstFile = evt.target.files[0];
                var uploadConfirm = confirm("Upload: " + firstFile.name + "?");
                var uploadLabel = document.getElementById("audioUploadLabel");
                uploadLabel.innerHTML = firstFile.name;
                if(uploadConfirm){
                  var storageRef = firebase.storage().ref("audio/" + firstFile.name);
                  var uploadTask = storageRef.put(firstFile);
                  uploadTask.on('state_changed', function(snapshot){
                    var percentUpload = document.getElementById("percentUpload");
                    percentUpload.textContent = "Uploading...";
                  }, function(error){
                    alert("An error occurred: " + error);
                  }, function() {
                    //alert("Successfully uploaded");
                    var percentUpload = document.getElementById("percentUpload");
                    percentUpload.textContent = "Successfully uploaded!";
                    var audioPath = document.getElementById("exhibitAudio");
                    audioPath.value = "audio/"+storageRef.fullPath;
                    console.log("successfully uploaded");
                  });
                }
              };
            </script>


          </div>
          <div class="inputContainer">
            <h2 class="longDescription"> Image (please select a high-resolution photo and upload below).</h2> <h3> It should be successfully uploaded and say images/[filename] in the box below: </h3><br>
            <input class='uploadFile' accept='image/*' name='fileUpload' type='file' id='imageUpload'/>
            <label for='imageUpload' id='imageUploadLabel'>Choose a file</label>
            <p id='percentUploadImage'>No file selected</p>
            <input type="text" id="exhibitImage" placeholder="images/[filename].jpg">
            <script>

              var imageUpload = document.getElementById("imageUpload");
              imageUpload.onchange = function(evt) {
                var firstFile = evt.target.files[0];
                var uploadConfirm = confirm("Upload: " + firstFile.name + "?");
                var uploadLabel = document.getElementById("imageUploadLabel");
                uploadLabel.innerHTML = firstFile.name;
                if(uploadConfirm){
                  var storageRef = firebase.storage().ref("images/" + firstFile.name);
                  var uploadTask = storageRef.put(firstFile);
                  uploadTask.on('state_changed', function(snapshot){
                    var percentUploadImage = document.getElementById("percentUploadImage");
                    percentUploadImage.textContent = "Uploading...";
                  }, function(error){
                    alert("An error occurred: " + error);
                  }, function() {
                    //alert("Successfully uploaded");
                    var percentUploadImage = document.getElementById("percentUploadImage");
                    percentUploadImage.textContent = "Successfully uploaded!";
                    var imagePath = document.getElementById("exhibitImage");
                    imagePath.value = "images/"+storageRef.name;
                    console.log("successfully uploaded"); //Khoi Le
                  });
                }
              };
            </script>


          </div>
          <div class="inputContainer">
            <h2 class="longDescription"> Summary (Like a Tweet! Capture the MOST interesting thing in a short but sweet summary): </h2><br>
            <textarea id="summary" rows="3" cols="50" placeholder="When people told him that he could never match Velazquez's masterpiece, Picasso told them 'this is MY meninas!'"></textarea>
          </div>
          <div class="inputContainer">
            <h2 class="longDescription"> Major Symbols (Separate by semicolons): </h2><br>
            <textarea id="symbols" rows="3" cols="50" placeholder="Shapes capture the mood of Picasso; Mirror and shadow leaves mystery; Dark monochrome creates an ominous tone"></textarea>
          </div>
          <div class="inputContainer">
            <h2 class="longDescription"> History of the Painting: </h2><br>
            <textarea id="historyOfPainting" rows="4" cols="50" placeholder="The original Las Meninas was painted in 1656 by Diego Velazquez, and captured the royal family's princesses. Picasso painted his versions of Las Meninas (58 in total) in the 1950's and wanted to emphasize how his versions conveyed his own meanings."></textarea>
          </div>
          <div class="inputContainer">
            <h2 class="longDescription"> History of the Artist: </h2><br>
            <textarea id="historyOfArtist" rows="4" cols="50" placeholder="Pablo Picasso is often referred to as the father of cubism, which can be seen in the geometric and abstract shapes of the figures in the painting"></textarea>
          </div>
          <div class="inputContainer">
            <h2 class="longDescription"> Videos (please use YouTube or Vimeo videos). </h2><h3>Find the "Embed" option and copy the 'src=' link and paste below, separated by semicolons). If no videos, please leave blank. </h3><br>
            <textarea id="videos" rows="3" cols="50" placeholder="https://www.youtube.com/embed/jc1Nfx4c5LQ; https://www.youtube.com/embed/as47s12LC"></textarea>
          </div>
          <button id="createPage" type="submit">Create page</button>
        </form>
      </div>

      <br>
      <h1 id="result"></h1>
      <br>
      <br>
    </div>
    <div id="footer">
      <div id="footerLinkBar">
        <a class="footerLinks" href="lunarsphere.io"> about lunarsphere </a>
        <a class="footerLinks" href="index.html"> triton database </a>
      </div>
      <div id="footerLogos">
        <h2 style="color: gray;">powered by <a class='h2Links' href='lunasphere.io'> LunaSphere </a> in conjunction with the <a class='h2Links' href='www.triton.org'>Triton Museum of Art</a>, Santa Clara, CA</h2>
        <img src='images/tritonIcon.png' id='logoPageCreatorFooter'></img>
        <img src='images/LogoTransparent.png' id='lunasphereLogoFooter'></img>
      </div>
      <div id="credits"> <h3 style='color:gray;'>Copyright 2016: Nikolai Flowers and Khoi Le </h3> </div>
    </div>

  </body>

</html>
