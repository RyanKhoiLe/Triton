<!DOCTYPE HTML>
<html>
<head>
  <!-- created by Khoi Le 2016 !-->
  <title> Triton Database Explorer </title>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="../stylesheets/tritonExploreCSS.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="icon" href="../images/tritonIconSmall.png">
  <script src="https://www.gstatic.com/firebasejs/3.3.0/firebase.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
</head>
  <body>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyCH2GOoz3WtmgKC8gs9-P0eHk02-sX9vS0",
        authDomain: "lunaspheretriton.firebaseapp.com",
        databaseURL: "https://lunaspheretriton.firebaseio.com",
        storageBucket: "lunaspheretriton.appspot.com",
      };
      firebase.initializeApp(config);

    var url = "https://lunaspheretriton.firebaseio.com";
      var firebaseRef = firebase.database();

      function checkUser(){
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            firebase.auth().signOut().then(function(){
              console.log("signed out");
            }, function(error){
              console.log("error signing out");
            });
          } else {
            //return;
          }
        });
        var email = document.getElementById("email").value;
        var password = document.getElementById("password").value;
        var resultDisplay = document.getElementById("result");
        firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
          var errorCode = error.code;
          var errorMessage = error.message;
          console.log(errorCode + " " + errorMessage);
          if(error.code === "auth/wrong-password"){
            resultDisplay.textContent = "Sorry, that password is incorrect";
          }
          if(error.code === "auth/user-not-found"){
            resultDisplay.textContent = "Sorry, that username is incorrect";
          }
          if(error.code === "auth/invalid-email"){
            resultDisplay.textContent = "Sorry, that is not a valid email";
          }
          // return;
        });
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            resultDisplay.textContent = "Logging in . . .";
            window.open("edithome.html", "_self");
          } else {
            //return;
          }
        });

      }

      var exhibitsArray = [];
      var exhibitTextContent = [];
      //TODO: USE ARRAY TO HOLD EXHIBITS, USE DISPLAY: NONE TO HIDE NON-RELEVANT, USE SEARCHVALUE TO LOOK FOR MATCHES IN ANY CHILD NODE OF EXHIBITOBJECT
      function exhibitObject(title, artist, timeStamp, views, img, fbID, room){
        this.title = title;
        this.artist = artist;
        this.timeStamp = timeStamp;
        this.views = views;
        this.img = img;
        this.fbID = fbID;
        this.room = room;
      }
      // var tempFBID;
      // var tempExhKey;
      // firebaseRef.ref('exhibitKeys/').on('child_added', function(snapshot){
      //   tempFBID = snapshot.val().key;
      //   tempExhKey = snapshot.val();
      //   console.log('snapshot val' + tempExhKey);
      // });
      var exhibitNames = ['cowell', 'warburton', 'permanent','jb','rotunda','sculpture','archive'];
      for(var i = 0; i < exhibitNames.length; i++){
        firebaseRef.ref('exhibits').child(exhibitNames[i]).on('child_added', function(snapshot){
          var snapshotKey = snapshot.key;
          console.log("snapshotKey: " + snapshotKey);
          var exhibits = snapshot.val();
        //console.log('id: ' + tempFBID);
          var title = exhibits.title;
          var artist = exhibits.artist;
          var timeStamp = exhibits.timeStamp;
          var views = exhibits.views;
          var img = exhibits.exhibitImage;
          var exhibitRoom = exhibits.exhibit;

          var newExhibit = new exhibitObject(title, artist, timeStamp, views, img, snapshotKey, exhibitRoom);
          exhibitsArray.push(newExhibit);

          createExhibitLink(newExhibit);
          console.log(exhibitsArray);
          //var artist = snapshot.val().artist;
          console.log(exhibits);
          console.log('title: ' + title);
        });
      }



      function getExhibitsArray(){
        return exhibitsArray;
      }
      var exhibitNum = 0;
      var trashIcon = '../images/icons/trash.png';
      function createExhibitLink(exhibit){ //loop through array??
        var newSearchResult = document.createElement('div');
        var searchTable = document.getElementById("searchTable");
        var centerBox = document.getElementById("centerBox");

        var artistLastName = exhibit.artist.substring(exhibit.artist.indexOf(' '));
        console.log('indexOf space: ' + exhibit.artist.indexOf(' '));
        var artistFirstName = exhibit.artist.substring(0, exhibit.artist.indexOf(' '));
        //var newIndex = document.createElement('div')
        newSearchResult.setAttribute('class', 'searchResult');
        newSearchResult.setAttribute('id', 'exhibitLink'+exhibitNum);
        newSearchResult.innerHTML = "<a class='resultLink' href='editexhibitMobile.html?0=" + exhibit.room + "&1=" + exhibit.fbID + "'>" +
          "<input type='checkbox' class='smallCheckbox'/>" +
          "<div class='titleBox'><h2>" + exhibit.title + " </h2></div>" +
          "<div class='artistBox'><h2>"+ artistLastName + ", " + artistFirstName + " </h2></div>" +
          "<div class='timeBox'><h2>" + exhibit.timeStamp + " </h2></div>" +
          "<div class='viewsBox'><h2>" + exhibit.views + "</h2></div>" +

          "</a>";
          if(exhibit.artist.indexOf(' ') == -1){
            newSearchResult.innerHTML = "<a class='resultLink' href='editexhibitMobile.html?0=" + exhibit.room + "&1=" + exhibit.fbID + "'>" +
              "<input type='checkbox' class='smallCheckbox'/>" +
              "<div class='titleBox'><h2>" + exhibit.title + " </h2></div>" +
              "<div class='artistBox'><h2>"+ artistLastName + "</h2></div>" +
              "<div class='timeBox'><h2>" + exhibit.timeStamp + " </h2></div>" +
              "<div class='viewsBox'><h2>" + exhibit.views + "</h2></div>" +

              "</a>";
          }
          var newDivBox = document.createElement("div");
          newDivBox.setAttribute("class", "imgBox");
          var newImgBox = document.createElement('img');
          newImgBox.setAttribute('id', 'exhibitImageBox' + exhibitNum);
          newImgBox.setAttribute('class', 'thumbnail');
          var storage = firebase.storage();
          var storageRef = storage.ref();

          var thisNum = exhibitNum;
          console.log(exhibit.img);
          if(exhibit.img){
            var spaceRef = storageRef.child(exhibit.img);
            storageRef.child(exhibit.img).getDownloadURL().then(function(url){
              var test = url;
              document.getElementById("exhibitImageBox" + thisNum).src = test;
            }).catch(function(error){

            });
          }


          newDivBox.appendChild(newImgBox);
          newSearchResult.appendChild(newDivBox);
          //console.log(exhibit.title + 'exhibitLink'+exhibitNum);
        var newButton = document.createElement('button');
        var textContent = newSearchResult.textContent;
        console.log(textContent);

        exhibitTextContent.push(textContent);
        exhibitNum++;
        searchTable.appendChild(newSearchResult);
        centerBox.appendChild(searchTable);
        console.log('link created');
      }
      function alertDelete(exhibit, num){
        console.log("CONFIRM DELETE?");
        console.log('exhibitLink'+num);
        var deleteConfirmation = confirm('Delete exhibit: ' + exhibit.title + '?'); //exhibit.title

        if(deleteConfirmation){
          console.log('exhibitLink'+num);
          document.getElementById("exhibitLink" + num).style.display='none';

          firebaseRef.ref('exhibits/' + exhibit.room +'/' + exhibit.fbID).remove();
          //firebaseRef.ref(''+exhibit.fbID).parent.remove();
          //location.href = 'databaseExplorer.html';

        }
        else{
          return;
        }
      }
      function selectAll(){
        console.log("SELECTING ALL");
        var inputs = document.getElementsByTagName('input');
        for(var i = 0; i < inputs.length; i++){
          if(inputs[i].type.toLowerCase() == 'checkbox'){
            // check the checkbox
            if(document.getElementById("masteCheckBox").checked){
              inputs[i].checked = true;
            }
            else{
              inputs[i].checked = false;
            }

          }
        }
      }
    </script>
    <div id="headBar">
      <a href="www.lunasphere.com"><img id="lunasphereLogo" src="../images/LogoTransparent.png" alt="Lunasphere"></a>
      <h1 id="pageTitle"> Edit Show Titles </h1>
      <a href="index.html"><img id="logoPageCreator" src="../images/tritonIcon.png" alt="triton"></a>
      <div id="navBar">
        <a class="navBarLink" href="edithome.html"> database home </a>
        <a class="navBarLink" href="databaseExplorer.html" style="text-decoration: underline"> page editor </a>
        <a class="navBarLink" href="pagecreatorMobile.html"> page creator </a>
        <a class="navBarLink" href="commentExplorer.html"> comment moderator </a>
        <a class="navBarLink" href="editShowTitles.html"> edit show titles </a>
        <a class="navBarLink" href="index.html"> triton database home </a>
        <a class="navBarLink" href="lunasphere.html"> visit lunasphere </a>
      </div>
    </div>
    <div id= "wrapper" >

      <div class="bigdaddy">
        <div class="babyform">


          <form id="editShowTitles" ng-submit="editShowTitles()">

            <label id="titleLabel">

            <div class="inputContainer">
                <div class="textContainer">

                  <h2> Cowell: </h2>
                </div>
              <input class="show" type="text" ng-model="cowellshowtitle" id="cowell" value="" placeholder="{{cowellshowtitle}}">
              <button class="update" type="submit"> Update </button>
            </div>
            <label id="artistLabel">


            <div class="inputContainer">
              <div class="textContainer">
                <h2> Warburton: </h2>
              </div>
              <input class="show" type="text" ng-model="warburtonshowtitle" id="warburton" value="" placeholder="{{warburtonshowtitle}}">
              <button class="update" type="submit"> Update </button>
            </div>


            <div class="inputContainer">
                <div class="textContainer">

                  <h2> Permanent: </h2>
                </div>
              <input class="show" type="text" ng-model="permanentshowtitle" id="permanent" value="" placeholder="{{permanentshowtitle}}">
              <button class="update" type="submit"> Update </button>
            </div>
            <label id="artistLabel">


            <div class="inputContainer">
              <div class="textContainer">
                <h2> Sculpture: </h2>
              </div>
              <input class="show" type="text" ng-model="sculptureshowtitle" id="sculpture" value="" placeholder="{{sculptureshowtitle}}">
              <button class="update" type="submit"> Update </button>
            </div>


            <div class="inputContainer">
                <div class="textContainer">

                  <h2> Rotunda: </h2>
                </div>
              <input class="show" type="text" ng-model="rotundashowtitle" id="rotunda" value="" placeholder="{{rotundashowtitle}}">
              <button class="update" type="submit"> Update </button>
            </div>
            <label id="artistLabel">


            <div class="inputContainer">
              <div class="textContainer">
                <h2> Jamison: </h2>
              </div>
              <input class="show" type="text" ng-model="jbhouseshowtitle" id="jbhouse" value="" placeholder="{{jbhouseshowtitle}}">
              <button class="update" type="submit"> Update </button>
            </div>


          </form>
        </div>

      <!-- Footer -->
      <div id="michelleFooter">
        <div id="footerLinkBar">
          <a class="footerLinks" href="lunasphere.html"> about lunasphere </a>
          <a class="footerLinks" href="index.html"> triton database </a>
        </div>
        <div id="footerLogos">
          <h2 style="color: gray;">powered by <a class='h2Links' href='lunasphere.html'> LunaSphere </a> in conjunction with the <a class='h2Links' href='http://www.tritonmuseum.org'>Triton Museum of Art</a>, Santa Clara, CA</h2>
          <img src='../images/tritonIcon.png' id='logoPageCreatorFooter'></img>
          <img src='../images/LogoTransparent.png' id='lunasphereLogoFooter'></img>
        </div>
        <div id="credits"> <h3 style='color:gray;'>Copyright 2016: Nikolai Flowers and Khoi Le </h3> </div>
      </div>



      </div> <!-- Close bigdaddy -->


    </div>
