<!DOCTYPE HTML>
<html>
  <head>
    <title>Triton Exhibit Database</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/tritonHomeCSS.css">
    <link rel="icon" href="images/tritonIconSmall.png">
    <script src="https://www.gstatic.com/firebasejs/3.2.1/firebase.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  </head>
  <body>
    <script>

      var config = {
        apiKey: "AIzaSyCVFksGcDoYDk23wAG58XdYdfyDL7urzUY",
        authDomain: "learnfirebase-43e98.firebaseapp.com",
        databaseURL: "https://learnfirebase-43e98.firebaseio.com",
        storageBucket: "learnfirebase-43e98.appspot.com",
      };
      firebase.initializeApp(config);
      var url = "https://learnfirebase-43e98.firebaseio.com";
      var firebaseRef = firebase.database();
      var storage = firebase.storage();

      var exhibitImage, title, artist, uniqueId;
      var exhibitLinkNum = 0;
      var tcArray = [];
      var exhibitTitles = [];
      var exhibitCode;
      firebaseRef.ref('exhibits/').on("child_added", function(snapshot){
        var fbID = snapshot.val();
        exhibitImage = fbID.exhibitImage;
        title = fbID.title;
        artist = fbID.artist;
        uniqueId = snapshot.key;
        exhibitCode = fbID.exhibitCode;
        createLink(uniqueId,  exhibitImage, title, artist, exhibitCode);
      });
      // var uniqueId;
      // firebaseRef.ref('exhibitKeys/').on("child_added", function(snapshot){
      //   uniqueId = snapshot.val().key;
      //
      // });

      function createLink(key, img, title, artist, exhibitCode){
        var exhibitList = document.getElementById("listOfExhibits");
        var newLink = document.createElement("a");
        newLink.setAttribute("href", "exhibit.html?id=" + key);
        newLink.setAttribute("id","exhibitLink" + exhibitLinkNum);

        var newDiv = document.createElement("div");
        newDiv.setAttribute("class", "exhibitDisplay");
        var newImage = document.createElement("img");
        newImage.setAttribute('id','exhibitLinkImage' + exhibitLinkNum);
        newImage.setAttribute('width','100%');
        var newExhibitTitle = document.createElement("div");
        newExhibitTitle.setAttribute('class','exhibitTitle');
        newExhibitTitle.innerHTML = "<div style='float:left; padding-left: 20px; padding-top: 20px; font-size:10px;'>" + exhibitCode + "</div><h1 class='exhibitTitleText'>" + title + " - " + artist + "</h1>"; //comment this if it gets messed up
        newLink.appendChild(newImage);
        newLink.appendChild(newExhibitTitle);
        var storage = firebase.storage();
        var storageRef = storage.ref();
        var spaceRef = storageRef.child(img);

        storageRef.child(img).getDownloadURL().then(function(url){
          var test = url;
          newImage.src = test;
        }).catch(function(error){

        });
        exhibitLinkNum++;
        var tc = newLink.textContent;
        tcArray.push(tc);
        newDiv.appendChild(newLink);
        exhibitTitles.push(title);
        exhibitList.appendChild(newDiv);
        console.log(exhibitTitles);
      }
    </script>

  	<div id="headBar">
    		<h1> Triton DB </h1>
    		<a href="index.html"><img id="logo" src="images/tritonIcon.png" alt="Triton"></a>

    </div>
    <hr>
    	<div id="wrapper">
    		<h1> Welcome to the Triton Museum Exhibit Database! </h1>
    		<img src="images/tritonLogo.png" alt="logo" width="95%"></img>
		      <input id="specialCode" type='text' value="1234" align="center" style="background-color: #FFF7E0;"></input>
		        <br>
		          <button type="button" id="enterCode">Search</button>
		            <br>
		              <a href='#' id="searchLink" style="padding-top: 10px; font-size: 24px;">Search for an exhibit</a>
		                <hr>
	                   <h2><b>Links to exhibits </b></h2>
                     <hr>
                     <div id="listOfExhibits">
                       <!-- <div class="exhibitDisplay">
                         <a href="exhibit1.html">
                           <img src="images/guernica.jpg" width="100%">
                           <div class="exhibitTitle"><h1 class="exhibitTitleText">Guernica - Pablo Picasso</h1></div>
                         </a>
                       </div> -->
                     </div>
                     <hr>
                     <div>
                       <h2>Powered by LunaSphere</h2>
                       <!-- <img id='lunasphereLogoFooter' src='images/LogoTransparent.png'> -->
                     </div>
                     <hr>
                     <div id='museumCuratorAccess'>
                       <a href='databaseLogin.html'> Museum Log-in </a>
                     </div>
      </div>

	    <!-- <table id="exhibitList">
	    	<tr>
	    		<td> <a href="exhibit1.html"> <img src="images/guernica.jpg" width="100%"><br> Guernica </a> </td>
	    	</tr>
	    </table> -->

	    <hr>
	    <script>
  		var input = document.getElementById("specialCode");
  		var myButton = document.getElementById("enterCode");
  		var searchLink = document.getElementById("searchLink");
  		var searchLinkDisplay = document.getElementById("searchLinkDisplay");
  		myButton.addEventListener("click", clickHandler, false);
      input.addEventListener("change", clickHandler, false);
  		function clickHandler(){
  			console.log("clicked " + input.value);
        var totalResults = 0;
        var specialNum;
        for(var i = 0; i < tcArray.length; i++){
          var search = input.value;
          if(tcArray[i].toLowerCase().includes(search.toLowerCase())){
            document.getElementById("exhibitLink" + i).style.display = "block";
            totalResults++;
            console.log(totalResults);
            specialNum = i;
          }
          else{
            document.getElementById("exhibitLink" + i).style.display = "none";
          }
        }
        if(totalResults == 1){
          console.log("ONE RESULT");
          console.log("change searchLink to: " + exhibitTitles[specialNum]);
          searchLink.textContent = "" + exhibitTitles[specialNum];
        }
        if(totalResults > 1){
          searchLink.textContent = "See results below:";
        }
  			if(input.value === "101"){
  				searchLink.innerHTML = "Guernica";
  				searchLink.setAttribute('href',"exhibit1.html");
  			}

  		}
  	</script>

  </body>
</html
